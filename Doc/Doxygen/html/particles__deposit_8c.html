<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PLUTO: /Users/mignone/PLUTO/Src/Particles/particles_deposit.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PLUTO
   &#160;<span id="projectnumber">4.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li><li class="navelem"><a class="el" href="dir_9206b596ebf640a5bddb105d741e15ea.html">Particles</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">particles_deposit.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Particle to grid deposition functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pluto_8h_source.html">pluto.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4f4dd7ffd1735a72c93ae099161ed865"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="particles__deposit_8c.html#a4f4dd7ffd1735a72c93ae099161ed865">Particles_DepositBoundaryExchange</a> (Data_Arr Q, int nelem, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:a4f4dd7ffd1735a72c93ae099161ed865"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a758be08b57d19c967a7f31a71ad814e8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="particles__deposit_8c.html#a758be08b57d19c967a7f31a71ad814e8">Particles_Density</a> (Particle *p, double *qd)</td></tr>
<tr class="separator:a758be08b57d19c967a7f31a71ad814e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Transfer particle quantities to the grid using deposition: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q_{ijk} = \sum_p W_p(x_{ijk}-x_p)q_p \]" src="form_241.png"/>
</p>
<p> where <code>qp</code> is a particle-related quantities (e.g. energy or mass). For deposition to be consistently done, particles can be everywhere in the domain, including ghost zones with the important exception of the very first and very last one. An error will occur in <a class="el" href="particles_8h.html#ab9f5cb6175c067b45e6ea5b1bf801d5c">Particles_GetWeights()</a> otherwise.</p>
<p>Alternatively, integer deposition can be used to verify the correctness of serial/parallel implementation: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ Q_{ijk} = \frac{q_{\max}}{C} \sum_p {\rm int}\left(C W_p(x_{ijk}-x_p) \frac{q_p}{q_{\max}}\right) \]" src="form_242.png"/>
</p>
<p> where <code>C</code> is a large number (<code>1.e6</code> by default) while <code>q_max</code> is the maximum value of <code>qp</code> over all particles.</p>
<p>Deposition is always followed by a boundary condition call, since quantities deposited in the ghost zones must be exchanged with neighbour processors.</p>
<dl class="section author"><dt>Authors</dt><dd>A. Mignone (<a href="#" onclick="location.href='mai'+'lto:'+'mig'+'no'+'ne@'+'ph'+'.un'+'it'+'o.i'+'t'; return false;">migno<span style="display: none;">.nosp@m.</span>ne@p<span style="display: none;">.nosp@m.</span>h.uni<span style="display: none;">.nosp@m.</span>to.i<span style="display: none;">.nosp@m.</span>t</a>)<br />
 <b>References</b> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>March 31, 2018 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a758be08b57d19c967a7f31a71ad814e8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a758be08b57d19c967a7f31a71ad814e8">&#9670;&nbsp;</a></span>Particles_Density()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Particles_Density </td>
          <td>(</td>
          <td class="paramtype">Particle *&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>qd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Simple deposition function used to compute particle density on the grid. </p>

</div>
</div>
<a id="a4f4dd7ffd1735a72c93ae099161ed865"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f4dd7ffd1735a72c93ae099161ed865">&#9670;&nbsp;</a></span>Particles_DepositBoundaryExchange()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Particles_DepositBoundaryExchange </td>
          <td>(</td>
          <td class="paramtype">Data_Arr&#160;</td>
          <td class="paramname"><em>Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nelem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Exchange boundary values between processors to complete the deposition process. If Q contains quantities in the boundaries, we first copy these values into auxiliary buffers <code>snd_bufL</code> and <code>snd_bufR</code> and then transfer them through an MPI Send/Recv call:</p>
<div class="fragment"><div class="line">Rank #0        A0|B0------C0|D0</div><div class="line">                          ^   |</div><div class="line">                          |   v </div><div class="line">Rank #1                   A1|B1------C1|D1</div><div class="line">                                     ^   |</div><div class="line">                                     |   v</div><div class="line">Rank #2                              A2|B2------C2|D2</div></div><!-- fragment --><p>Seen from rank # 1, we have</p><ul>
<li><code>A1</code> = snd_bufL</li>
<li><code>D1</code> = snd_bufR</li>
<li><code>D0</code> = rcv_bufL</li>
<li><code>A2</code> = rcv_bufR</li>
</ul>
<p>Here 'L' or 'R' refer to the processor to the left (rank #0) and to the right (rank #2), respectively. In 2D or 3D we iterate over dimensions. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 7 2018 18:33:51 for PLUTO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
