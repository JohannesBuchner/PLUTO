<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>PLUTO: /Users/mignone/PLUTO/Src/MHD/ShearingBox/sb_flux.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUTO
   &#160;<span id="projectnumber">4.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li><li class="navelem"><a class="el" href="dir_393faf7c97aebfe9abb0723b81bbf748.html">MHD</a></li><li class="navelem"><a class="el" href="dir_a4295f36876b266efbc238c44a1ad819.html">ShearingBox</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sb_flux.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Enforce conservation at the X1 boundaries in the shearing-box module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="pluto_8h_source.html">pluto.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5453d8ef0f693db82abf956f3c1f892a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#a5453d8ef0f693db82abf956f3c1f892a">swL</a>&#160;&#160;&#160;0.0</td></tr>
<tr class="separator:a5453d8ef0f693db82abf956f3c1f892a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aad9af0cd82fa2cbdf5ae814090a52807"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#aad9af0cd82fa2cbdf5ae814090a52807">SB_SaveFluxes</a> (<a class="el" href="struct_state__1_d.html">State_1D</a> *state, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:aad9af0cd82fa2cbdf5ae814090a52807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc900e28d8388b00c09c8db8c60361f0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#acc900e28d8388b00c09c8db8c60361f0">SB_CorrectFluxes</a> (Data_Arr U, double t, double dt, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:acc900e28d8388b00c09c8db8c60361f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa947dd23295335a047486909c311b60b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#aa947dd23295335a047486909c311b60b">SB_CorrectEMF</a> (<a class="el" href="struct_e_m_f.html">EMF</a> *emf, Data_Arr V0, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:aa947dd23295335a047486909c311b60b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a355bed3e11752a04887460c0a4b398ce"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#a355bed3e11752a04887460c0a4b398ce">ExchangeX</a> (double *bufL, double *bufR, int nel, <a class="el" href="struct_grid.html">Grid</a> *grid)</td></tr>
<tr class="separator:a355bed3e11752a04887460c0a4b398ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a453f42d50d64d083a1f6ecc9c429ef70"><td class="memItemLeft" align="right" valign="top">static double ***&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#a453f42d50d64d083a1f6ecc9c429ef70">FluxL</a></td></tr>
<tr class="separator:a453f42d50d64d083a1f6ecc9c429ef70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dec259ea6e92b4312d8406445b25981"><td class="memItemLeft" align="right" valign="top">static double ***&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sb__flux_8c.html#a1dec259ea6e92b4312d8406445b25981">FluxR</a></td></tr>
<tr class="separator:a1dec259ea6e92b4312d8406445b25981"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file provides functions to store and then modify the upwind fluxes computed during the Riemann solver at the leftmost and righmost physical boundaries. These tasks are performed only when either SB_SYMMETRIZE_HYDRO, SB_SYMMETRIZE_EY, SB_SYMMETRIZE_EZ flags are set to YES in Src/MHD/shearingbox.h and are useful to avoid loss of conservation in the hydrodynamical variables (density, momentum, energy) and/or magnetic fields.</p>
<p>This is first achieved by calling the <a class="el" href="sb__flux_8c.html#aad9af0cd82fa2cbdf5ae814090a52807">SB_SaveFluxes()</a> function during the time stepping scheme, with the purpose of storing the leftmost and rightmost conservative fluxes in the x-direction into the static arrays FluxL[] and FluxR[].</p>
<p>These fluxes are then subsequently used by <a class="el" href="sb__flux_8c.html#acc900e28d8388b00c09c8db8c60361f0">SB_CorrectFluxes()</a> which interpolates the fluxes and properly correct leftmost and rightmost cell-centered flow quantities to ensure conservation.</p>
<p>The treatment of staggered magnetic field is done similarly by <a class="el" href="sb__flux_8c.html#aa947dd23295335a047486909c311b60b">SB_CorrectEMF()</a>.</p>
<p><b>References</b> </p><ul>
<li>"??" <br />
 Mignone et al, in preparation</li>
</ul>
<dl class="section author"><dt>Authors</dt><dd>A. Mignone (<a href="#" onclick="location.href='mai'+'lto:'+'mig'+'no'+'ne@'+'ph'+'.un'+'it'+'o.i'+'t'; return false;">migno<span style="display: none;">.nosp@m.</span>ne@p<span style="display: none;">.nosp@m.</span>h.uni<span style="display: none;">.nosp@m.</span>to.i<span style="display: none;">.nosp@m.</span>t</a>)<br />
 G. Muscianisi (<a href="#" onclick="location.href='mai'+'lto:'+'g.m'+'us'+'ica'+'ni'+'si@'+'ci'+'nec'+'a.'+'it'; return false;">g.mus<span style="display: none;">.nosp@m.</span>ican<span style="display: none;">.nosp@m.</span>isi@c<span style="display: none;">.nosp@m.</span>inec<span style="display: none;">.nosp@m.</span>a.it</a>)<br />
 G. Bodo (<a href="#" onclick="location.href='mai'+'lto:'+'bod'+'o@'+'oat'+'o.'+'ina'+'f.'+'it'; return false;">bodo@<span style="display: none;">.nosp@m.</span>oato<span style="display: none;">.nosp@m.</span>.inaf<span style="display: none;">.nosp@m.</span>.it</a>)</dd></dl>
<dl class="section date"><dt>Date</dt><dd>Feb 14, 2014 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a5453d8ef0f693db82abf956f3c1f892a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define swL&#160;&#160;&#160;0.0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets the weight coefficient in the range [0,1] used during flux symmetrization at the left and right boundaries, </p><pre class="fragment">FL -&gt; swL*FL    + swR*I(FR)
FR -&gt; swL*I(FL) + swR*FR 
</pre><p>where swR=1-swL and I() stands for conservative interpolation. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a355bed3e11752a04887460c0a4b398ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ExchangeX </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>bufL</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>bufR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send bufL owned by processor at X1_BEG to the processor at X1_END; Send bufR owned by processor at X1_END to the processor at X1_BEG; </p>

</div>
</div>
<a class="anchor" id="aa947dd23295335a047486909c311b60b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SB_CorrectEMF </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_e_m_f.html">EMF</a> *&#160;</td>
          <td class="paramname"><em>emf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Data_Arr&#160;</td>
          <td class="paramname"><em>V0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Correct the electromotive force by enforcing symmetrization in order to guarantee that Bx on the left is mapped from Bx on the right. This is done by re-defining the y- and z-components of the electric field as follows:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ E_{z,L} \to \frac{1}{2}\left[E_{z,L} + \Aop^{t_E}_{>}(E_{z,R}) + wF_{+}\right] \,,\qquad E_{z,R} \to \frac{1}{2}\left[\Aop^{t_E}_<(E_{z,L}) + E_{z,R} - wF_-\right] \]" src="form_171.png"/>
</p>
<p> where <img class="formulaInl" alt="$t_E =$" src="form_172.png"/> is time level of the electric field, $$ are the forward (&gt;) or backward (&lt;) shift operators. The corrective terms <img class="formulaInl" alt="$F_{\pm}$" src="form_173.png"/> are the upwind numerical flux computed in the advection of the x-component of magnetic field: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ F_{+} = B_{x,L} + \frac{\widetilde{\Delta B}_{xL}}{2} \left(1 - \frac{\delta t}{\Delta y}w\right) \,,\qquad F_{-} = B_{x,R} - \frac{\widetilde{\Delta B}_{xR}}{2} \left(1 - \frac{\delta t}{\Delta y}w\right) \]" src="form_174.png"/>
</p>
<p> where <img class="formulaInl" alt="$ \delta t\ne \Delta t$" src="form_175.png"/> is the time increment of the shift operator applied to the magnetic field, <img class="formulaInl" alt="$B_{xL}$" src="form_176.png"/> and <img class="formulaInl" alt="$B_{xR}$" src="form_177.png"/> are the x component of magnetic field computed at some intermediate time <code>tB</code> while </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \widetilde{\Delta B}_{xL} = \frac{ \overline{\Delta B}_{xL} + \Aop^{tB}_{>}(\overline{\Delta B}_{xR})}{2} \;,\qquad \widetilde{\Delta B}_{xR} = \frac{ \Aop^{tB}_{<}(\overline{\Delta B}_{xL}) + \overline{\Delta B}_{xR}}{2} \]" src="form_178.png"/>
</p>
<p> are the arithmetic average of the limited slopes of <code>Bx</code> computed at the left and right boundaries.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">emf</td><td>pointer to <a class="el" href="struct_e_m_f.html">EMF</a> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">V0</td><td>4D array of staggered fields </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>pointer to array of <a class="el" href="struct_grid.html">Grid</a> structures </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Symmetrization of Ez can only be done using weight coefficients of 1/2 (and not swL, swR) since limited slopes (dbxL_lim and dbxR_lim) do not satisfy the property that their sum is zero (as expected for a periodic function). </dd></dl>

</div>
</div>
<a class="anchor" id="acc900e28d8388b00c09c8db8c60361f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SB_CorrectFluxes </td>
          <td>(</td>
          <td class="paramtype">Data_Arr&#160;</td>
          <td class="paramname"><em>U</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Interpolate x-fluxes FLuxL and FluxR and properly correct leftmost and rightmost cells to ensure conservation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">U</td><td>data array containing cell-centered quantities </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">t</td><td>the time step at which fluxes have been computed </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>the time step being used in the integrator stage </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>pointer to array of <a class="el" href="struct_grid.html">Grid</a> structures </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Modify the values of FluxR (on the left) and FluxL (on the right) to properly account for the shift induced by the moving boundaries. For safety reason (avoid overwriting arrays when a processor owns both the left and the right side) we first copy, then interpolate and finally average:</dd></dl>
<ul>
<li><p class="startli">On the left boundary:</p>
<p class="startli">FluxR -&gt; FluxLR -&gt; I(FluxLR) -&gt; fL = wL*FluxL + wR*FluxLR</p>
</li>
<li><p class="startli">On the right boundary:</p>
<p class="startli">FluxL -&gt; FluxLR -&gt; I(FluxLR) -&gt; fR = wL*FluxLR + wR*FluxR </p><hr/>
</li>
</ul>

</div>
</div>
<a class="anchor" id="aad9af0cd82fa2cbdf5ae814090a52807"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SB_SaveFluxes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_state__1_d.html">State_1D</a> *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_grid.html">Grid</a> *&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Store leftmost and rightmost conservative fluxes in the x direction into FluxL and FluxR.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">state</td><td>pointer to a <a class="el" href="struct_state__1_d.html">State_1D</a> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>pointer to an array of <a class="el" href="struct_grid.html">Grid</a> structures</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This function has no return value. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a453f42d50d64d083a1f6ecc9c429ef70"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double*** FluxL</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Array of fluxes at the left x-boundary. </p>

</div>
</div>
<a class="anchor" id="a1dec259ea6e92b4312d8406445b25981"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">double*** FluxR</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Array of fluxes at the right x-boundary. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 31 2015 12:33:06 for PLUTO by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
